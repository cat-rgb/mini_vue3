{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export {reactive} from \"./reactive\"\r\nexport {effect} from \"./effect\"", "export function isObject(obj) {\r\n    return obj !== null && typeof obj === 'object'\r\n}", "export let activeEffect = undefined\r\n\r\nclass ReactiveEffect {\r\n    public active = true // \u6FC0\u6D3B\u72B6\u6001\r\n    public parent = null\r\n    // [Set(name reactiveEffect), Set(age reactiveEffect)]\r\n    public deps = [] // \u5F53\u524Deffect\u5BF9\u5E94\u7684\u4F9D\u8D56Set\r\n\r\n    constructor(public fn, public scheduler) {\r\n    }\r\n\r\n    run() {\r\n        if (!this.active) return this.fn() // \u975E\u6FC0\u6D3B,\u53EA\u6267\u884C\u51FD\u6570,\u4E0D\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\r\n        // \u54CD\u5E94\u5F0F\u4F9D\u8D56\u6536\u96C6\r\n\r\n        try {\r\n            console.log('effect\u88AB\u6267\u884C') //  \u5206\u652F\u5207\u6362\u4E0D\u52A0cleanup\u4F1A\u91CD\u590D\u6267\u884C\r\n            this.parent = activeEffect\r\n            activeEffect = this\r\n            cleanupEffect(this)\r\n            return this.fn()\r\n        } finally {\r\n            activeEffect = this.parent\r\n        }\r\n\r\n    }\r\n\r\n    stop() {\r\n        if (this.active) {\r\n            this.active = false\r\n            cleanupEffect(this)\r\n        }\r\n    }\r\n}\r\n\r\nfunction cleanupEffect(reactiveEffect) {\r\n    const {deps} = reactiveEffect\r\n    for (let i = 0; i < deps.length; i++) {\r\n        deps[i].delete(reactiveEffect)\r\n    }\r\n    reactiveEffect.deps.length = 0\r\n}\r\n\r\nexport function effect(fn, options: any = {}) {\r\n    const _effectFn = new ReactiveEffect(fn, options.scheduler)\r\n    _effectFn.run()\r\n    const runner = _effectFn.run.bind(_effectFn)\r\n    runner.effect = _effectFn\r\n\r\n    return runner\r\n\r\n\r\n}\r\n\r\n//\u4E00\u4E2A\u5C5E\u6027\u5BF9\u5E94\u591A\u4E2Aeffect  \u4E00\u4E2Aeffect\u5BF9\u5E94\u591A\u4E2A\u5C5E\u6027\r\nconst targetMap = new WeakMap()  // \u4F9D\u8D56\r\nexport function track(target, type, key) {\r\n    if (!activeEffect) return\r\n    let depsMap = targetMap.get(target)\r\n    if (!depsMap) {\r\n        targetMap.set(target, (depsMap = new Map()))\r\n    }\r\n    let deps = depsMap.get(key)\r\n    if (!deps) {\r\n        depsMap.set(key, (deps = new Set()))\r\n    }\r\n    let shouldTrack = deps.has(activeEffect)\r\n    if (!shouldTrack) {\r\n        deps.add(activeEffect)\r\n        activeEffect.deps.push(deps)\r\n    }\r\n}\r\n\r\nexport function trigger(target, type, key, value) {\r\n    const depsMap = targetMap.get(target)\r\n    if (!depsMap) return // \u6CA1\u5728\u4F9D\u8D56\u4E2D\u627E\u5230,\u8BF4\u660E\u6CA1\u5728\u6A21\u677F\u4E2D,\u4E0D\u7528\u89E6\u53D1\u9875\u9762\u66F4\u65B0\r\n    let effects = depsMap.get(key)\r\n    if (effects) {\r\n        effects = new Set(effects)\r\n        effects.forEach(effect => {\r\n            if (effect !== activeEffect) {\r\n                if (effect.scheduler) {\r\n                    effect.scheduler() // \u8C03\u7528\u7528\u6237\u7684scheduler\r\n                } else {\r\n                    effect.run() // \u8C03\u7528effect\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n}\r\n\r\n\r\n// \u5D4C\u5957effect \u9700\u8981\u4FDD\u8BC1activeEffect\u7684\u987A\u5E8F\r\n// effect(() => {\r\n//     obj.a\r\n//     effect(() => {\r\n//         obj.b\r\n//     })\r\n//     obj.c\r\n// })", "import {activeEffect, track, trigger} from \"./effect\";\r\nimport {isObject} from \"@vue/shared\";\r\nimport {reactive} from \"./reactive\";\r\n\r\nexport const enum ReactiveFlags {\r\n    IS_REACTIVE = '_v_isReactive'\r\n}\r\n\r\nexport const handler = {\r\n    get(target: any, key: string | symbol, receiver: any): any {\r\n        if (key === ReactiveFlags.IS_REACTIVE) {\r\n            return true\r\n        }\r\n        // console.log('get \u76D1\u542C')\r\n        track(target, 'get', key)\r\n        const res = Reflect.get(target, key, receiver)  // Reflect.get\u7684\u8FD4\u56DE\u503C\u662Ftarget[key]\r\n        console.log('res', res)\r\n        if (isObject(res)) {\r\n            return reactive(res)\r\n        }\r\n\r\n        return res\r\n    },\r\n    set(target: any, key: string | symbol, newValue: any, receiver: any): boolean {\r\n        // console.log('set \u8BBE\u7F6E')\r\n        let oldValue = target[key]\r\n        const result = Reflect.set(target, key, newValue, receiver)\r\n        if (oldValue !== newValue) {\r\n            trigger(target, 'set', key, newValue)\r\n        }\r\n        return result\r\n    }\r\n}\r\n\r\n// \u5BF9\u8C61 \u67D0\u4E2A\u5C5E\u6027 -> \u591A\u4E2Aeffect\r\n// weakMap = {target\u5BF9\u8C61: Map('key\u5C5E\u6027': [Set(\u591A\u4E2Aeffect)])}\r\n\r\n", "import {isObject} from \"@vue/shared\";\r\nimport {handler, ReactiveFlags} from \"./baseHandler\";\r\n\r\nconst reactiveMap = new WeakMap()\r\n\r\n\r\nexport function reactive(obj) {\r\n    if (!isObject(obj)) return\r\n\r\n    // \u5982\u679Cobj\u662F\u4E00\u4E2A\u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61, \u8BBF\u95EE\u5185\u90E8\u5C5E\u6027,\u5982\u679C\u8FD4\u56DEtrue,\u8BF4\u660E\u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\u4E86,\u76F4\u63A5\u8FD4\u56DE\u8BE5\u5BF9\u8C61\r\n    if (obj[ReactiveFlags.IS_REACTIVE]) {\r\n        return obj\r\n    }\r\n\r\n    // \u5982\u679C\u539F\u59CB\u5BF9\u8C61\u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\u4E86,\u5C31\u4ECEmap\u4E2D\u53D6\u51FA\u7F13\u5B58\u7684\u503C\u9632\u6B62\u91CD\u590D\u4EE3\u7406\r\n    if (reactiveMap.has(obj)) {\r\n        return reactiveMap.get(obj)\r\n    }\r\n    const proxy = new Proxy(obj, handler\r\n    )\r\n    reactiveMap.set(obj, proxy)\r\n    return proxy\r\n}\r\n\r\n// proxy\u4E0D\u4F7F\u7528target[key] \u65B9\u5F0F\u662F\u4E3A\u4E86\u907F\u514Dthis\u88AB\u66F4\u6539\r\n// let obj = {\r\n//     name: '1',\r\n//     get alias() {\r\n//         return this.name\r\n//     }\r\n// }"],
  "mappings": "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",
  "names": ["effect"]
}
